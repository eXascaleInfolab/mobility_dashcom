# Dashcom mobility

Analysis of the mobility data from Dashcom. User's coordinates time series are processed and the result outputs two analytical metrics:
1. User's current position and whether it is inside the specified room 
2. Analysis of the movement patterns between readings (distance, time, speed) to validate the consistency and quality of the data and warn about potential issues.

## Prerequisites

- OS: Windows, macOS or Linux.
- Platform (CPU): x86, x64 or Arm64.

___

## Installation

- Install latest version of .NET 6 SDK. Follow the instruction appropriate for your OS and platform at https://dotnet.microsoft.com/en-us/download/dotnet/6.0
- Restart the terminal/console after finishing the installation.
- Open terminal/console of your OS and type to install dotnet-script tool:
```bash
    dotnet tool install -g dotnet-script
```

___

## Running the analysis

```bash
 git clone https://github.com/eXascaleInfolab/mobility_dashcom.git mobility_dashcom
 cd mobility_dashcom
 dotnet-script dashcom_analysis.csx data/recording_2022-03-11.txt
```
- `data/recording_2022-03-11.txt`: the log file you want to analyse.
- Two output files will be created: `data/recording_2022-03-11.records.txt` (further refered to as 'Records') and `data/recording_2022-03-11.relative.txt` (further: 'Relative').
- Optionally, a `room.txt` file can be specified (an example is provided, see [remarks](#remarks) for how it should be structured):
```bash
    dotnet-script dashcom_analysis.csx data/recording_2022-05-30.txt room/room.txt
```

___

## Data formatting

### Input
- File generated by device recording script

### Output
- 'Records' file, each line looks like the following:
```11:32:01: @0.918195/0.292566 -- 4.3435```
    - "11:32:01" is the timestamp of the reading.
    - "@0.918195/0.292566" are the coordinates (adapted to remove first digits that are always the same).
    - "4.3435" is the geo distance (in meters, see [techniques](#techniques)) from the "base position", which is chosen from the first entry in the input file.
    - The line can also contain other information, for example:
        - "[INSIDE:ROOM]" or "[INSIDE:BASE]" - is displayed if the current coordinates are within the room. If `room.txt` is provided, then it determines the position based on room's box coordinates (and says [:ROOM]). If not - the room is assumed to be a circle (radius = 5m) with the center at the base position (showed [:BASE]).

- 'Relative' file, each line looks like the following:
`11:41:20: moved 20.4950 m	in 14.81 sec	at the speed of 1.3843 m/s`
    - The line represents information relative to the previous record entry, so the first record is skipped.
    - "11:32:01" is the timestamp.
    - "20.4950 m" is the geo distance (in meters) moved since the last recorded position.
    - "14.81 sec" is the amount of time (in seconds) from the last record.
    - "1.3843 m/s" is the person's speed estimated from the distance and time.
    - The line can also contain other information, for example:
        - "[INFO:LONG]" - is displayed if the time since the last reading has exceeded 1 minute, this normally indicates long idle time without movement.
        - "[WARN:SPEED]" - is displayed if registered speed is higher than 2.5 m/s, since it is at the limit of human walking speed, usually it represents inaccuracies of readings (different base stations etc).

___

### Techniques:

- Geographical distance calculation from the coordinates, implementation according to "Spherical Earth projected to a plane" formula: https://en.wikipedia.org/wiki/Geographical_distance#Spherical_Earth_projected_to_a_plane
- Detection of a point inside a convext polygon.

___

### Remarks:

- For a proper detection of a person inside the room one needs a polygon defining it. A fallback of using a single point designating the room is not very accurate.
    - Detection with a single point relies on Euclidean distance and there are no good alternatives to this because even if we decide to use the "box" shape of the room (i.e. Manhttan distance) - we don't know the orientation of the room, we can only assume that two of the walls are parallel to the meridians, which is not necessarily the case.
    - If we know the coordinates of the corners of the room, then any algorithm that detects if the point lies within a convex polygon can be employed and applied to coordinates directly without using geo distance.
        - Current implementation assumes a convex polygon, but other more sophisticated methods can be used for non-convex rooms. Circular rooms can be handled using the radius of a base point method.
        - File `room.txt` has to contain a list of coordinates in the format of `latitude,longitude`, one per line, at least three points. Points always have to be specified clockwise or counterclockwise, in other words - no lines should cross.

- The quality of the information that can be extracted using this analysis depends on the quality of the data. There are a few technical limitations:
    - For example `2022-03-11` has a lot of anomalies. It's possible to detect some of them, we employ warnings about sudden positional jumps exceeding human walking speed and long periods of no updates to the position, but there is not much that can be done to correct them.
    - Sleeping devices seem to send no updates, which is not a problem for post-processing analysis, however this has to be addressed for a real-time analysis. Might be problematic to detect if the person is still in the room, or if a sleeping device was moved out.
    - Ultimately, an implementation of a system based on such readings has to be robust and should try to re-verify information though multiple channels (if possible) and use some time margins to make sure a reading is not a one-off.
